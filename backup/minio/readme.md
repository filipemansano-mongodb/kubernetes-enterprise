# MinIO Setup Guide

> NOTE: This step is completely optional, this guide describes how to set up a local s3 server

This guide outlines the steps to configure MinIO using the MinIO Operator in a Minikube environment.

## Steps

### Install MinIO Operator
```sh
helm repo add minio-operator https://operator.min.io
helm install \
    operator minio-operator/operator \
    --namespace minio-operator \
    --create-namespace
```

### Install MinIO Kubernetes Plugin

#### Install Krew
Follow the instructions to install Krew:
[Krew Installation Guide](https://krew.sigs.k8s.io/docs/user-guide/setup/install/)


#### Install minio plugin
```sh
kubectl krew update
kubectl krew install minio
```

### Create a New MinIO Tenant
```sh
kubectl minio tenant create                             \
                     minio-tenant-1                     \
                     --servers          1               \
                     --volumes          1               \
                     --capacity         15Gi            \
                     --namespace        minio-operator  \
                     --disable-tls                      \
                     --storage-class    standard
```

Copy the username and password generated by the tenant creation command:
```sh
Username: <COPY-THIS-USER-NAME>
Password: <COPY-THIS-PASSWORD>
```
> MinIO will not display these again

### Access MinIO Console

#### Create the secret
```sh
kubectl apply -f minio-secret.yaml --namespace minio-operator
```

#### Get the JWT token
```sh
kubectl -n minio-operator get secret console-sa-secret -o jsonpath="{.data.token}" | base64 --decode
```

#### Forward the port to access the operator locally
```sh
kubectl --namespace minio-operator port-forward svc/console 9090:9090
```

- Open the page in your browser: `http://localhost:9090/namespaces/minio-operator/tenants/minio-tenant-1/configuration`
- Copy the `MINIO_ROOT_PASSWORD` and `MINIO_ROOT_USER` values
- Forward the port of tenant console: `kubectl --namespace minio-operator port-forward svc/minio-tenant-1-console 9095:9090`
- Access the page `http://localhost:9095/buckets`
- Create a new bucket with the name `velero-mdb-ent-test`


# References
 - [MinIO Deploy Operator With Helm](https://min.io/docs/minio/kubernetes/upstream/operations/install-deploy-manage/deploy-operator-helm.html)